---
title: 计算机网络协议
date: 2019-09-18 19:47:40
keywords: 网络协议分层
description: 网络协议为什么需要分层
categories: 
  - 计算机
tags:
  - 网络协议
comments: false
---

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09182135.png)

越是下面的层越是靠近硬件；越是上面的层越是靠近用户。互联网分层一般分为五层比较容易理解；每一层都是为了完成一种功能。为了实现这些功能，就需要制定一套规则，称为“协议”。

# 物理层

**定义：**<u>就是把电脑连接起来的物理手段；主要规定了网络的一些电气特性，作用是负责传送0和1的电信号。</u>

物理层有时也称为“实体层”；我们将电脑连接起来可以使用光缆、电缆、双绞线、无限电波。

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09182212.png)

# 链接层

**定义：** **规定了电信号的分组，他在物理层的上方，确定了0和1的分组方式。**

**典型应用：**在宿舍里自己组网玩联机游戏。

## 以太网协议

- ["以太网"](http://zh.wikipedia.org/wiki/以太网)（Ethernet）的协议在电信号分组方式中占据了主导地位。

### 以太网数据包

- 以太网规定一组电信号构成一个数据包，称为帧(Frame).每帧分成两个部分：**标头**和 **数据**
  1. 标头：比如发送者、接受者、数据类型等等；"数据"则是数据包的具体内容。
  2. "标头"的长度，固定为18字节。"数据"的长度，最短为46字节，最长为1500字节。因此，整个"帧"最短为64字节，最长为1518字节。如果数据很长，就必须分割成多个帧进行发送。

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09191808.png)

## MAC地址

以太网规定，连入网络的所有设备，都必须具有"网卡"接口。数据包必须是从一块网卡，传送到另一块网卡。网卡的地址，就是数据包的发送地址和接收地址，这叫做MAC地址。每块网卡出厂的时候，都有一个全世界独一无二的MAC地址，长度是48个二进制位，通常用12个十六进制数表示。

前6个十六进制数是厂商编号，后6个是该厂商的网卡流水号。有了MAC地址，就可以定位网卡和数据包的路径了。

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09191815.png)

## 广播

- 一块网卡怎么会知道另一块网卡的MAC地址？

  ARP协议，可以解决这个问题；

- 有了MAC地址，系统怎样才能把数据包准确送到接收方？

  太网采用了一种很"原始"的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09191831.png)

> 上图中，1号计算机向2号计算机发送一个数据包，同一个子网络的3号、4号、5号计算机都会收到这个包。它们读取这个包的"标头"，找到接收方的MAC地址，然后与自身的MAC地址相比较，如果两者相同，就接受这个包，做进一步处理，否则就丢弃这个包。这种发送方式就叫做"广播"（broadcasting）。

**有了数据包的定义、网卡的MAC地址、广播的发送方式，"链接层"就可以在多台计算机之间传送数据了。**—最基本的一种通讯方式；比如宿舍的局域网；自己组网玩联机游戏。

# 网络层

**目的：** **区分哪些MAC地址属于同一个子网络导致"网络层"的诞生。它的作用是引进一套新的地址，使得我们能够区分不同的计算机是否属于同一个子网络。这套地址就叫做"网络地址"，简称"网址"。**

"网络层"出现以后，每台计算机有了两种地址，一种是MAC地址，另一种是网络地址。两种地址之间没有任何联系，MAC地址是绑定在网卡上的，网络地址则是管理员分配的，它们只是随机组合在一起。

网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是先处理网络地址，然后再处理MAC地址。

## IP协议

**定义：** **规定网络地址的协议，叫做IP协议。它所定义的地址，就被称为IP地址。**

**作用：** **一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。**

目前，广泛采用的是IP协议第四版，简称IPv4。这个版本规定，网络地址由32个二进制位组成。

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09191858.png)

### IP数据包

根据IP协议发送的数据，就叫做IP数据包；我们可以把IP数据包直接放进以太网数据包的"数据"部分，因此完全不用修改以太网的规格。**这就是互联网分层结构的好处：上层的变动完全不涉及下层的结构。**

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09191901.png)

## ARP协议

- **作用：**

  **通过ARP(Address Resolution Protocol)协议就可以得到同一个子网络内的主机MAC地址，可以把数据包发送到任意一台主机之上了。**

- **机制：**

  ARP协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的IP地址，在对方的MAC地址这一栏，填的是FF:FF:FF:FF:FF:FF，表示这是一个"广播"地址。它所在子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身的IP地址进行比较。如果两者相同，都做出回复，向对方报告自己的MAC地址，否则就丢弃这个包。

# 传输层

- **由来：**

  我们需要一个参数确定数据包到底供哪个程序（进程）使用。这个参数就叫做"端口"（port），它其实是每一个使用网卡的程序的编号。每个数据包都发到主机的特定端口，所以不同的程序就能取到自己所需要的数据。

- **功能**

  **"传输层"的功能，就是建立"端口到端口"的通信。相比之下，"网络层"的功能是建立"主机到主机"的通信。只要确定主机和端口，我们就能实现程序之间的交流。**

## UDP协议

**UDP协议是为了在数据包中加入端口信息。**

须在数据包中加入端口信息，这就需要新的协议。最简单的实现叫做UDP协议，它的格式几乎就是在数据前面，加上端口号。

### UDP数据包

UDP数据包，也是由"标头"和"数据"两部分组成。"标头"部分主要定义了发出端口和接收端口，"数据"部分就是具体的内容。然后，把整个UDP数据包放入IP数据包的"数据"部分。

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09191921.png)

## TCP协议

UDP协议的优点是比较简单，容易实现，但是缺点是可靠性较差，一旦数据包发出，无法知道对方是否收到。

TCP协议能够确保数据不会遗失。它的缺点是过程复杂、实现困难、消耗较多的资源。TCP数据包和UDP数据包一样，都是内嵌在IP数据包的"数据"部分。

# 应用层

**"应用层"的作用，就是规定应用程序的数据格式。**

现在的以太网的数据包就变成下面这样。

![image](https://raw.githubusercontent.com/HaviLee/Blog-Images/master/高手/09191929.png)

